# ============================================================
# SchoolPay Backend — Environment Variables
# Copy this file to .env and fill in your real values.
# NEVER commit .env to Git. Add it to .gitignore.
# ============================================================

# ── App ──────────────────────────────────────────────────────
APP_NAME=SchoolPay
APP_VERSION=1.0.0
ENVIRONMENT=development          # Change to: production on VPS
DEBUG=false
# PRIORITY-0: keep low-level HTTP client wire logs off in production
HTTP_CLIENT_DEBUG_LOGS=false

# PRIORITY-0: brute-force protection for login endpoints
LOGIN_RATE_LIMIT_WINDOW_SECONDS=300
LOGIN_RATE_LIMIT_MAX_PER_IP=20
LOGIN_RATE_LIMIT_MAX_PER_EMAIL=10

# PRIORITY-0: in-memory idempotency cache TTL (seconds)
IDEMPOTENCY_TTL_SECONDS=600
# Shared SQLite file for idempotency keys/events (cross-worker safe on one instance)
IDEMPOTENCY_DB_PATH=/tmp/schoolpay_idempotency.db

# ── Supabase ─────────────────────────────────────────────────
# Dashboard → Settings → API
SUPABASE_URL=https://YOUR_PROJECT_ID.supabase.co
SUPABASE_ANON_KEY=eyJhbGci...your_anon_key
SUPABASE_SERVICE_KEY=eyJhbGci...your_service_role_key

# ── JWT ───────────────────────────────────────────────────────
# Generate with: openssl rand -hex 32
JWT_SECRET_KEY=replace_this_with_64_random_hex_characters
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=480    # 8 hours
JWT_REFRESH_TOKEN_EXPIRE_DAYS=30

# ── Paystack ──────────────────────────────────────────────────
# Dashboard → Settings → API Keys & Webhooks
# Use sk_test_xxx during development, sk_live_xxx in production
PAYSTACK_SECRET_KEY=sk_test_your_secret_key
PAYSTACK_PUBLIC_KEY=pk_test_your_public_key
PAYSTACK_WEBHOOK_SECRET=your_webhook_secret    # Set in Paystack dashboard

# ── Termii (SMS + WhatsApp) ───────────────────────────────────
# Dashboard → API Tokens
TERMII_API_KEY=your_termii_api_key
TERMII_SENDER_ID=SchoolPay          # Must be pre-approved by Termii
TERMII_CHANNEL=generic

# ── n8n ───────────────────────────────────────────────────────
# If running locally: http://localhost:5678/webhook
# If running in Docker: http://n8n:5678/webhook
N8N_WEBHOOK_BASE_URL=http://n8n:5678/webhook

# ── URLs ──────────────────────────────────────────────────────
FRONTEND_URL=https://app.schoolpay.ng
PAYMENT_PAGE_URL=https://pay.schoolpay.ng



# For local development:
# FRONTEND_URL=http://localhost:3000
# PAYMENT_PAGE_URL=http://localhost:3000

# ── Platform Config ───────────────────────────────────────────
PLATFORM_FEE_PER_STUDENT=500.0
MINIMUM_BILLABLE_STUDENTS=100
TRIAL_PERIOD_DAYS=30
GRACE_PERIOD_DAYS=14

# ── Database Schema ──────────────────────────────────────────
DB_SCHEMA=schoolpay


# ── Session 3: n8n Internal Communication ────────────────────
# Shared secret for n8n → FastAPI /internal/* endpoints.
# Generate with: openssl rand -hex 32
# Must ALSO match SCHOOLPAY_INTERNAL_KEY in n8n/.env
INTERNAL_SECRET_KEY=generate_a_random_hex_string_here

# ── Session 4: File Uploads ───────────────────────────────────
# Supabase Storage bucket name for bank transfer proofs.
# Create this bucket in the Supabase Dashboard before using.
# See migrations/005_storage.sql for full setup instructions.
STORAGE_PROOF_BUCKET=payment-proofs

# Maximum file size for proof uploads (in MB)
# Default is 5 — matches Supabase free tier generous limits
MAX_FILE_SIZE_MB=5
