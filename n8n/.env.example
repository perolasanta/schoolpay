# ============================================================
# n8n Environment Variables
# File: n8n/.env
#
# These vars are read by n8n at startup.
# In Docker Compose, inject via the `environment:` block.
# In the workflow editor, reference as: $env.VAR_NAME
#
# HOW TO USE IN n8n WORKFLOWS:
#   {{ $env.TERMII_API_KEY }}
#   {{ $env.SCHOOLPAY_API_URL }}
#
# SETUP STEPS:
#   1. Copy this file: cp n8n/.env.example n8n/.env
#   2. Fill in all values below
#   3. Restart n8n: docker compose restart n8n
# ============================================================

# ── n8n Internal Config ──────────────────────────────────────
N8N_HOST=0.0.0.0
N8N_PORT=5678
N8N_PROTOCOL=http

# Basic auth protects the n8n editor UI
# NGINX will NOT expose n8n publicly — only you access it via VPN or SSH tunnel
N8N_BASIC_AUTH_ACTIVE=true
N8N_BASIC_AUTH_USER=admin
N8N_BASIC_AUTH_PASSWORD=change_this_to_something_strong

# Timezone — critical for the 8AM cron to fire at the right time
GENERIC_TIMEZONE=Africa/Lagos

# n8n stores workflow data here (mapped to Docker volume)
N8N_USER_FOLDER=/home/node/.n8n

# Webhook base URL — how n8n knows its own public address
# This is the internal Docker URL that FastAPI uses to reach n8n
# FastAPI calls: http://n8n:5678/webhook/payment-success
N8N_WEBHOOK_BASE_URL=http://n8n:5678

# ── SchoolPay API ────────────────────────────────────────────
# n8n calls FastAPI to fetch student data and log notifications
# Inside Docker network, use the service name
SCHOOLPAY_API_URL=http://api:8000

# Shared secret for n8n → FastAPI /internal/* endpoints
# Generate: openssl rand -hex 32
# Must match INTERNAL_SECRET_KEY in FastAPI .env
SCHOOLPAY_INTERNAL_KEY=generate_a_random_32_char_string_here

# ── Termii SMS + WhatsApp ────────────────────────────────────
# Get from: https://termii.com → Dashboard → API Keys
TERMII_API_KEY=your_termii_api_key_here
TERMII_BASE_URL=https://api.ng.termii.com/api
TERMII_SENDER_ID=SchoolPay

# ── Payment Page URL ─────────────────────────────────────────
# Used in SMS reminders: "Pay here: {PAYMENT_PAGE_URL}/pay/{token}"
PAYMENT_PAGE_URL=https://pay.schoolpay.ng

# ── n8n Execution Settings ───────────────────────────────────
# How long to keep execution history (saves disk space)
EXECUTIONS_DATA_SAVE_ON_ERROR=all
EXECUTIONS_DATA_SAVE_ON_SUCCESS=none
EXECUTIONS_DATA_SAVE_MANUAL_EXECUTIONS=true
EXECUTIONS_DATA_MAX_AGE=168    # 7 days in hours

# ── Database for n8n (optional — defaults to SQLite) ─────────
# For production with many workflows, use Postgres
# DB_TYPE=postgresdb
# DB_POSTGRESDB_HOST=your_supabase_host
# DB_POSTGRESDB_PORT=5432
# DB_POSTGRESDB_DATABASE=n8n
# DB_POSTGRESDB_USER=n8n_user
# DB_POSTGRESDB_PASSWORD=n8n_password
